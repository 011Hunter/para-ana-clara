<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Ana Clara ❤️</title>
    <style>
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #0b0101; color: #fff;
            font-family: 'Georgia', serif; overflow: hidden;
        }

        #canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }

        .main-ui {
            position: relative; z-index: 2; height: 100vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center; transition: opacity 1s ease;
        }

        .container-box {
            background: rgba(0, 0, 0, 0.7);
            padding: 40px; border-radius: 20px;
            border: 1px solid #ff0055; box-shadow: 0 0 30px #ff0055;
            max-width: 80%;
        }

        h1 { font-size: 2.5em; color: #ff4d6d; margin-bottom: 20px; }
        
        .btn-secret {
            cursor: pointer; background: #4a4a4a; border: 1px solid #666;
            padding: 15px 30px; color: #ddd; border-radius: 5px;
            font-family: 'Courier New', monospace; font-weight: bold;
            transition: 0.3s; margin-top: 20px; outline: none;
        }
        .btn-secret:hover { background: #ff4d6d; color: white; transform: scale(1.05); }

        /* A CARTA VINTAGE */
        #carta-container {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; z-index: 10;
            background: #121212; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 1.5s ease;
        }

        .folha {
            background: #e6d5b8; 
            background-image: url('https://www.transparenttextures.com/patterns/parchment.png');
            width: 85%; max-width: 500px; height: 80vh;
            padding: 60px 40px; border-radius: 5px;
            box-shadow: 0 0 60px rgba(0,0,0,1);
            color: #2c1e14; font-family: 'Courier New', Courier, monospace;
            position: relative; overflow-y: auto; text-align: center;
            border: 15px solid transparent;
            border-image: url('https://www.transparenttextures.com/patterns/exclusive-paper.png') 30 stretch;
            outline: 2px solid #3d2b1f;
            outline-offset: -10px;
        }

        .folha::before { content: "✿"; position: absolute; top: 10px; left: 10px; font-size: 25px; color: #3d2b1f; opacity: 0.5; }
        .folha::after { content: "✿"; position: absolute; top: 10px; right: 10px; font-size: 25px; color: #3d2b1f; opacity: 0.5; }

        #texto-carta { font-size: 1.1rem; line-height: 1.6; white-space: pre-wrap; font-weight: 600; text-align: left; margin-top: 20px; }

        .selo {
            width: 70px; height: 70px; background: #7a0000;
            border-radius: 50%; margin: 40px auto 20px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            color: #cfb53b; font-weight: bold; border: 2px dashed #5a0000;
            opacity: 0; transition: opacity 2s ease; font-size: 1.2rem;
        }

        .btn-restart {
            display: none; background: transparent; border: 1px solid #3d2b1f;
            color: #3d2b1f; padding: 8px 15px; cursor: pointer;
            font-family: 'Courier New', monospace; font-size: 0.8rem;
            margin-bottom: 20px; opacity: 0; transition: 1s;
        }

        .cursor { display: inline-block; width: 10px; height: 18px; background: #2c1e14; animation: blink 0.7s infinite; vertical-align: middle; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body onclick="tocarMusica()">

    <canvas id="canvas"></canvas>

    <div class="main-ui" id="inicio">
        <div class="container-box">
            <h1>Para a Ana Clara ❤️</h1>
            <p id="typing-inicio" style="min-height: 40px; font-size: 1.2rem;"></p>
            <button class="btn-secret" onclick="abrirCarta(event)">NÃO CLIQUE AQUI</button>
        </div>
    </div>

    <div id="carta-container">
        <div class="folha">
            <h2 style="margin:0; font-size: 1.5rem;">Para: Ana Clara</h2>
            <h2 style="margin:0; font-size: 1.5rem;">De: Erick</h2>
            <div style="width: 50%; height: 1px; background: #3d2b1f; margin: 15px auto; opacity: 0.3;"></div>
            
            <div id="texto-carta"></div><span id="cursor-carta" class="cursor" style="display:none;"></span>
            
            <div id="meu-selo" class="selo">E&A</div>
            <button id="btn-recomecar" class="btn-restart" onclick="recomecarTudo()">↻ Ler novamente</button>
        </div>
    </div>

    <audio id="musica" loop>
        <source src="careless-whisper.m4a" type="audio/mp4">
    </audio>
    <audio id="som-tecla" preload="auto">
        <source src="https://raw.githubusercontent.com/rafaelwo/typing-sound/master/key.mp3" type="audio/mpeg">
    </audio>

    <script>
        const textoBoasVindas = "Você é a melhor parte de todos os meus dias...";
        const textoCarta = "Ana Clara,\n\nHoje o dia é todo seu, mas o presente quem ganha todos os dias sou eu por ter você ao meu lado. É impossível não admirar a pessoa incrível que você é. Sua doçura, sua força e esse brilho único que só você tem.\n\nVocê é perfeita do seu jeito, com cada detalhe que te faz ser exatamente quem você é. Eu te amo não apenas pelo que somos juntos, mas por tudo o que você me inspira a ser.\n\nQue seu aniversário seja tão lindo quanto o seu sorriso. Feliz aniversário, meu amor!";

        const musica = document.getElementById('musica');
        const somTecla = document.getElementById('som-tecla');

        // Toca a música no primeiro clique
        function tocarMusica() {
            if (document.getElementById('inicio').style.display !== 'none') {
                musica.play().catch(() => {});
            }
            somTecla.load();
        }

        // Efeito de digitação inicial
        let idxInicio = 0;
        function typeInicio() {
            document.getElementById("typing-inicio").innerHTML = "";
            idxInicio = 0;
            function escrever() {
                if (idxInicio < textoBoasVindas.length) {
                    document.getElementById("typing-inicio").innerHTML += textoBoasVindas.charAt(idxInicio);
                    idxInicio++;
                    setTimeout(escrever, 60);
                }
            }
            escrever();
        }

        // Função para trocar para a carta
        function abrirCarta(e) {
            if(e) e.stopPropagation();
            
            // PARA A MÚSICA
            musica.pause();
            musica.currentTime = 0;
            
            document.getElementById('inicio').style.opacity = '0';
            
            setTimeout(() => {
                document.getElementById('inicio').style.display = 'none';
                const container = document.getElementById('carta-container');
                container.style.display = 'flex';
                setTimeout(() => {
                    container.style.opacity = '1';
                    iniciarEscritaCarta();
                }, 500);
            }, 1000);
        }

        // Escrita da carta com som realista
        function iniciarEscritaCarta() {
            let i = 0;
            const elemento = document.getElementById('texto-carta');
            const cursor = document.getElementById('cursor-carta');
            elemento.textContent = "";
            cursor.style.display = 'inline-block';
            
            function escrever() {
                if (i < textoCarta.length) {
                    elemento.textContent += textoCarta.charAt(i);
                    
                    // Som de máquina de escrever
                    const som = new Audio(somTecla.querySelector('source').src);
                    som.playbackRate = 0.9 + (Math.random() * 0.2); 
                    som.volume = 0.2;
                    som.play();
                    
                    i++;
                    let delay = 65 + Math.random() * 75;
                    // Pausa maior em pontuações
                    if (['.', ',', '!', '?'].includes(textoCarta.charAt(i-1))) delay += 450;
                    
                    setTimeout(escrever, delay);
                } else {
                    cursor.style.display = 'none';
                    document.getElementById('meu-selo').style.opacity = '1';
                    setTimeout(() => {
                        const btn = document.getElementById('btn-recomecar');
                        btn.style.display = 'inline-block';
                        setTimeout(() => btn.style.opacity = '0.6', 100);
                    }, 2000);
                }
            }
            escrever();
        }

        // Função para recomeçar o processo
        function recomecarTudo() {
            document.getElementById('carta-container').style.opacity = '0';
            document.getElementById('meu-selo').style.opacity = '0';
            document.getElementById('btn-recomecar').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('carta-container').style.display = 'none';
                document.getElementById('inicio').style.display = 'flex';
                setTimeout(() => {
                    document.getElementById('inicio').style.opacity = '1';
                    typeInicio();
                    tocarMusica();
                }, 100);
            }, 1000);
        }

        // Corações de fundo
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let hearts = [];

        class Heart {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 8 + 4;
                this.speedY = Math.random() * 0.5 + 0.2;
                this.color = ['#ff4d6d', '#ff758f', '#ff0055', '#ffffff'][Math.floor(Math.random()*4)];
                this.opacity = Math.random();
            }
            draw() {
                ctx.globalAlpha = this.opacity;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
            update() {
                this.y -= this.speedY;
                if (this.y < -20) this.y = canvas.height + 20;
                this.opacity += (Math.random() - 0.5) * 0.03;
                if (this.opacity < 0.1) this.opacity = 0.1;
                if (this.opacity > 0.7) this.opacity = 0.7;
            }
        }

        for(let i=0; i<45; i++) hearts.push(new Heart());

        function animate() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            hearts.forEach(h => { h.update(); h.draw(); });
            requestAnimationFrame(animate);
        }

        window.onload = () => { animate(); typeInicio(); };
    </script>
</body>
</html>